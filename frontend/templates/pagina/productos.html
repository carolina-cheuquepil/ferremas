{% extends 'base.html' %}
<!--TÃ­tulo-->
{% block titulo %}CatÃ¡logo - Ferremas{% endblock %} {% block extra_css %}
<style>
  .btn-comprar {
    background-color: #0d6efd;
    color: white;
  }
</style>
{% endblock %} {% block subtitulo %}
<h2 class="text-center mb-4">CatÃ¡logo de Productos</h2>
{% endblock %} {% block contenido %}
<div class="row">
  {% for producto in productos %}
  <div class="col-md-4 mb-4">
    <div class="card h-100">
      {% if producto.imagen %}
      <img
        src="{{ producto.imagen.url }}"
        class="card-img-top"
        alt="{{ producto.nombre_producto }}"
      />
      {% endif %}
      <div class="card-body">
        <h5 class="card-title">{{ producto.nombre_producto }}</h5>
        <p class="card-text">{{ producto.marca }}</p>
        <p class="card-text">
          <strong>${{ producto.precio|floatformat:0 }}</strong>
          <strong>ðŸ‡ºðŸ‡¸ {{ producto.precio_usd }}</strong>
        </p>
        {% if user.is_authenticated %}
        <button
          class="btn btn-comprar w-100 agregar-carrito"
          data-producto-id="{{ producto.producto_id }}"
        >
          Comprar
        </button>
        {% else %}
        <a
          href="/api/clientes/login/form/"
          class="btn btn-outline-primary w-100"
        >
          Comprar
        </a>
        {% endif %}
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %} {% block extra_js %} {% if user.is_authenticated %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const botones = document.querySelectorAll(".agregar-carrito");

    botones.forEach((boton) => {
      boton.addEventListener("click", function () {
        const productoId = this.getAttribute("data-producto-id");

        fetch("/pedidos/carrito/agregar/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken"),
          },
          body: JSON.stringify({
            producto_id: productoId,
            cantidad: 1,
          }),
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.mensaje || "Producto agregado al carrito");
          })
          .catch((error) => {
            alert("Error al agregar al carrito");
            console.error(error);
          });
      });
    });

    function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
          const cookie = cookies[i].trim();
          if (cookie.substring(0, name.length + 1) === name + "=") {
            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
            break;
          }
        }
      }
      return cookieValue;
    }
  });
</script>
{% endif %} {% endblock %}
